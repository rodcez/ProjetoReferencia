var indiceCenarioSelecionadoCalculo=0,indiceVersaoSelecionada=0,produtoComercialAnaliseRisco,indiceLinhasTaxaResseguro=0,indiceCenarioSelecionadoRelatorios,indiceVersaoSelecionadaRelatorios;window.AnaliseDeRiscoUi={initialize:function(n){indiceVersaoSelecionada=0;indiceCenarioSelecionadoCalculo=0;window.AnaliseDeRiscoUi.addMasks();window.AnaliseDeRiscoUi.preencheDadosDoCalculo();window.AnaliseDeRiscoUi.validaExbicaoSubSessaoCNAE();window.AnaliseDeRiscoUi.carregarCenarios();window.AnaliseDeRiscoUi.carregarVersoesDoCenario();window.AnaliseDeRiscoUi.preencherCamposDaVersao();window.AnaliseDeRiscoUi.preencherExcedenteTecnico();window.AnaliseDeRiscoUi.disableEnableCamposPorVersao();n&&n()},addMasks:function(){$(".mask999").mask("999");$(".maskMoneyPercent2").maskMoney({precision:2,decimal:","});$(".maskMoneyPercent2Negative").maskMoney({precision:2,decimal:",",allowNegative:!0});$(".maskMoneyPercent4").maskMoney({precision:4,decimal:","})},preencherCamposDaVersao:function(){$("#nomeVersao").val(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].nomeVersao);$("#selectTabuaMortalidade").val(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].codigoTipoTabelaTaxa);$("#selectTabuaMortalidade").trigger("change");$("#DescontoAgravoTecnico").val(helperFormatacao.formatarDecimal(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].percentualDescontoAgravoTecnico,2));cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].valorLimiteRetencaoResseguro!=0&&$("#selectLimiteRetencao").val(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].valorLimiteRetencaoResseguro);$("#selectLimiteRetencao").trigger("change");$("#TotalVidasVersao").val(helperFormatacao.formatarDecimal(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].quantidadeTotalVidas));for(var n=0;n<cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length;n++)n!=0&&typeof($("#idadeMinimaResseguro_"+n)=="undefined")&&(window.AnaliseDeRiscoUi.InserirLinhaTaxaResseguro(n),indiceLinhasTaxaResseguro=+n),cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[n].idadeMinima>0&&$("#idadeMinimaResseguro_"+n).val(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[n].idadeMinima),cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[n].idadeMaxima>0&&$("#idadeMaximaResseguro_"+n).val(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[n].idadeMaxima),cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[n].percentualTaxa>0&&$("#taxaPorMil_"+n).val(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[n].percentualTaxa);$("#CapitalMedioCenario").val(helperFormatacao.formatarDecimal(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].valorCapitalMedio,2,!0))},carregarCenarios:function(){$("#cenariosAR > li").remove();cotacao.CenariosCotacao.forEach(function(n){n.numeroCenario==1?$("#cenariosAR").append("<li class='active'><a data-toggle='tab' href='#' id='liCen"+n.numeroCenario+"AR'>Cen. "+n.numeroCenario+"<\/a><\/li >"):$("#cenariosAR").append("<li><a data-toggle='tab' href='#' id='liCen"+n.numeroCenario+"AR'>Cen. "+n.numeroCenario+"<\/a><\/li >")});$("#cenariosAR a").unbind("shown.bs.tab");$("#cenariosAR a").on("shown.bs.tab",function(n){window.AnaliseDeRiscoEvents.OnChangeCenario($(n.target).closest("li").index(),$(n.relatedTarget).closest("li").index())})},carregarVersoesDoCenario:function(){$("#selectVsCalculo").empty();cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo.forEach(function(n){$("#selectVsCalculo").append('<option value="'+n.numeroVersao+'">'+n.numeroVersao+"<\/option>")})},InserirLinhaTaxaResseguro:function(n){var t=$("#TaxaDeResseguroTemplate").render({indice:n});$(t).insertBefore("#btnsTaxaResseguro")},RemoverLinhaTaxaResseguro:function(n){$("#taxaDeResseguro_"+n).remove()},removerTodasLinhaTaxaResseguro:function(){if(indiceLinhasTaxaResseguro>=1)for(x=1;x<=indiceLinhasTaxaResseguro;x++)$("#taxaDeResseguro_"+x).remove();$("#idadeMinimaResseguro_0").val("");$("#idadeMaximaResseguro_0").val("");$("#taxaPorMil_0").val("");$("#taxaDeResseguro_0").show();indiceLinhasTaxaResseguro=0},LimparVersao:function(){$("#selectLimiteRetencao").empty();produtoComercialAnaliseRisco.limitesRetencaoResseguro.limitesRetencaoResseguro.forEach(function(n){n.indicadorValorLimiteRetencaoPadrao=="S"?$("#selectLimiteRetencao").append('<option selected  value="'+n.valorLimiteRetencao+'">'+n.valorLimiteRetencao.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})+"<\/option>"):$("#selectLimiteRetencao").append('<option value="'+n.valorLimiteRetencao+'">'+n.valorLimiteRetencao.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})+"<\/option>")});$("#selectTabuaMortalidade").empty();produtoComercialAnaliseRisco.tipoTabelaTaxa.tipoTabelaTaxa.forEach(function(n){n.indicadorTabelaPadrao=="S"?$("#selectTabuaMortalidade").append('<option selected value="'+n.codigoTipoTabelaTaxa+'">'+n.descricaoTipoTabelaTaxa+"<\/option>"):$("#selectTabuaMortalidade").append('<option value="'+n.codigoTipoTabelaTaxa+'">'+n.descricaoTipoTabelaTaxa+"<\/option>")});$("#selectVsCalculo").val()!=1&&$("#nomeVersao").val(null);$("#DescontoAgravoTecnico").val(0);for(var n=$('[id*="taxaDeResseguro_"]').length-1;n>0;n--)$("#taxaDeResseguro_"+n).remove();$("#idadeMinimaResseguro_0").val("");$("#idadeMaximaResseguro_0").val("");$("#taxaPorMil_0").val("")},preencheDadosDoCalculo:function(){window.AnaliseDeRiscoUi.preencherCNAE();cotacao.PercentualDespesaAdministrativa==null?($("#ProcentagemDACotacao").val(helperFormatacao.formatarDecimal(produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMaximoDespesasAdministrativas,2)),$("#ProcentagemDACotacao").change()):$("#ProcentagemDACotacao").val(helperFormatacao.formatarDecimal(cotacao.PercentualDespesaAdministrativa,2));produtoComercialAnaliseRisco.limitesRetencaoResseguro.limitesRetencaoResseguro.forEach(function(n){n.indicadorValorLimiteRetencaoPadrao=="S"?$("#selectLimiteRetencao").append('<option selected  value="'+n.valorLimiteRetencao+'">'+n.valorLimiteRetencao.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})+"<\/option>"):$("#selectLimiteRetencao").append('<option value="'+n.valorLimiteRetencao+'">'+n.valorLimiteRetencao.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})+"<\/option>")});$("#selectTabuaMortalidade").empty();produtoComercialAnaliseRisco.tipoTabelaTaxa.tipoTabelaTaxa.forEach(function(n){n.indicadorTabelaPadrao=="S"?$("#selectTabuaMortalidade").append('<option selected value="'+n.codigoTipoTabelaTaxa+'">'+n.descricaoTipoTabelaTaxa+"<\/option>"):$("#selectTabuaMortalidade").append('<option value="'+n.codigoTipoTabelaTaxa+'">'+n.descricaoTipoTabelaTaxa+"<\/option>")})},preencherExcedenteTecnico:function(){$("#PorcentagemDA").val(helperFormatacao.formatarDecimal(cotacao.ExcedenteTecnico.PercentualDespesaAdministrativa,2));$("#PorcentagemIBNR").val(helperFormatacao.formatarDecimal(cotacao.ExcedenteTecnico.PercentualIBNR,2));$("#PorcentagemDistribuicao").val(helperFormatacao.formatarDecimal(cotacao.ExcedenteTecnico.PercentualDistribuicaoEstipulante,2));$("#MesesGatilho").val(cotacao.QuantidadeMesesGatilho)},validaExbicaoSubSessaoCNAE:function(){$("#rbEstipulanteFisica").prop("checked")?$(".CNAE-hide").hide():$(".CNAE-hide").show()},preencherCNAE:function(){if(produtoComercialAnaliseRisco.restricoesCNAE.restricaoCodigoCNAE==!0)$("#prodCnaeOrcamentoTxt").text("Risco Excluído"),$("#prodCnaeComparacao").text("Risco Excluído"),$("#coenfDescAgravo").hide();else{let n=cotacao.CoeficienteDescontoAgravoCnae?helperFormatacao.formatarDecimal(cotacao.CoeficienteDescontoAgravoCnae,4):helperFormatacao.formatarDecimal(produtoComercialAnaliseRisco.descontoAgravoCNAE[0].percentualDescontoAgravo,4);if(produtoComercialAnaliseRisco.descontoAgravoCNAE.length==1)$("#coenfDescAgravo").val(n),$("#divCnaeComp").hide();else if(produtoComercialAnaliseRisco.descontoAgravoCNAE.length>1){$("#coenfDescAgravo").val(n);let t=helperFormatacao.formatarDecimal(produtoComercialAnaliseRisco.descontoAgravoCNAE[1].percentualDescontoAgravo,4),i=produtoComercialAnaliseRisco.descontoAgravoCNAE[1].desc;$("#legendaProdComp").text(`Compare CNAE - ${i}`);$("#prodCnaeComparacao").text(t);$("#divCnaeComp").show()}}},adicionarVersao:function(n){$("#selectVsCalculo").append('<option value="'+n+'">'+n+"<\/option>")},disableEnableCamposPorVersao:function(){let n=$("#selectVsCalculo").val();n==1||cotacao.Status.Codigo>=3&&cotacao.Status.Codigo!=15?($("#btnRemover").prop("disabled",!0),$("#nomeVersao").prop("disabled",!0)):($("#btnRemover").prop("disabled",!1),$("#nomeVersao").prop("disabled",!1))},validaPreenchimentoCamposVersao:function(){$("#nomeVersao").val()==""&&($("#nomeVersao").addClass("input-validation-error"),notification("erro","",""))},validaExportarRelatorio:function(){$("#selectVsCalculoRel").val()==""&&($("#selectVsCalculoRel").addClass("input-validation-error"),notification("erro","Versão do cálculo não selecionada!"));$("#selecPlanoRel").val()==""&&($("#selecPlanoRel").addClass("input-validation-error"),notification("erro","Número do plano do cálculo não selecionado!"))}};window.AnaliseDeRiscoFunctions={initialize:function(n){window.AnaliseDeRiscoFunctions.analisarRiscoCenario(function(){n&&n()});window.AnaliseDeRiscoFunctions.obterCapitalMedio();window.RelacoesVidaFunctions.atualizarTotaldeVidas()},calcularCenario:function(){$.ajax({url:"/calculo/CotacaoCenario",type:"post",contentType:"application/json",success:function(){closeModalWait();notification("sucesso","Cálculo gerado com sucesso","");cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].indicadorVersaoCalculada=!0;window.RelatoriosAnaliseDeRiscoUi.adicionarVersaoNoDropdown(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].numeroVersao);window.CotacaoFunctions.atualizarObjetoCotacao();window.RelatoriosAnaliseDeRiscoUi.carregarCenarios();window.ControleDeAcessoCotacaoFunctions.ValidaExibicaoDasAbas();window.ControleDeAcessoCotacaoFunctions.validaExibicaoDasSessoesAbaAnaliseRisco()},error:function(n){var i,t;for(closeModalWait(),i=JSON.parse(n.responseText),t=0;t<i.length;t++)notification("erro",i[t],"")},data:JSON.stringify({IdCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].numeroCenario,NumeroVersao:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].numeroVersao,NumeroPlano:null,CoeficienteDescontoAgravoCnae:cotacao.CoeficienteDescontoAgravoCnae,IndicadorRiscoExcluido:cotacao.IndicadorRiscoExcluido,PercentualDespesaAdministrativa:cotacao.PercentualDespesaAdministrativa,QuantidadeMesesGatilho:cotacao.QuantidadeMesesGatilho,ExcedenteTecnico:JSON.parse(JSON.stringify(cotacao.ExcedenteTecnico)),Versao:JSON.parse(JSON.stringify(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada]))})})},analisarRiscoCenario:function(n){$.ajax({url:"/calculo/AnaliseRisco",type:"post",contentType:"application/json",success:function(t){produtoComercialAnaliseRisco=t.value;n&&n()},error:function(){},data:JSON.stringify({IdCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].numeroCenario,NumeroPlano:null,NumeroVersao:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].numeroVersao,CodigoProdutoComercial:parseInt(cotacao.ProdutoComercial.Codigo),DataReferencia:cotacao.DataReferencia,CodigoCNAE:cotacao.Itens[0].Estipulante.CodigoCNAE,CodigoOrgaoEmissor:cotacao.Filial.Codigo})})},exportarProjecaoFaturamento:function(){$.ajax({url:"/relatorio/ProjecaoFaturamento",type:"post",contentType:"application/json",success:function(n){n.fileContents!=null?(blob=converBase64toBlob(n.fileContents,n.contentType),saveFile(blob,n.fileDownloadName)):notification("erro","Relatório não disponível para exportação!")},error:function(){notification("erro","Erro ao tentar exportar o arquivo!")},data:JSON.stringify({IdCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario,NumeroPlano:parseInt($("#selecPlanoRel").val()),NumeroVersao:parseInt($("#selectVsCalculoRel").val()),TipoRelatorio:"ProjecaoFaturamento"})})},obterCapitalMedio:function(n){$.ajax({url:"/calculo/CapitalMedio",type:"post",contentType:"application/json",success:function(t){$("#CapitalMedioCenario").val(t.value.mediaCapitalSegurado.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}));cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].valorCapitalMedio=t.value.mediaCapitalSegurado;n&&n()},error:function(){},data:JSON.stringify({IdCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].numeroCenario,NumeroPlano:null,NumeroVersao:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].numeroVersao})})},salvarVersao:function(n){$.ajax({url:"/cenarios/SalvarVersao/",type:"post",contentType:"application/json",success:function(){closeModalWait();n&&n()},error:function(n){var i,t;for(closeModalWait(),i=JSON.parse(n.responseText),t=0;t<i.length;t++)notification("erro",i[t],"")},data:JSON.stringify({NumeroCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].numeroCenario,Versao:JSON.parse(JSON.stringify(window.AnaliseDeRiscoFunctions.getVersaoSalvar()))})})},getVersaoSalvar:function(){let n=cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro,t=n.filter(function(n){return n.idadeMinima!=null&&n.idadeMaxima!=null&&n.percentualTaxa!=null});return cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.splice(0,n.length,...t),cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada]},removerVersao:function(n){$.ajax({url:"/cenarios/ExcluirVersaoVidas/",type:"post",contentType:"application/json",success:function(){closeModalWait();n&&n()},error:function(n){var i,t;for(closeModalWait(),i=JSON.parse(n.responseText),t=0;t<i.length;t++)notification("erro",i[t],"")},data:JSON.stringify({NumeroCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].numeroCenario,NumeroVersao:cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].numeroVersao})})},InserirLinhaTaxaResseguro:function(){cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.push(new TaxasResseguro(null,null,null));indiceLinhasTaxaResseguro=indiceLinhasTaxaResseguro+1},RemoverLinhaTaxaResseguro:function(n){cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.splice(n,1);indiceLinhasTaxaResseguro=indiceLinhasTaxaResseguro-1},alterarDACotacao:function(n){cotacao.PercentualDespesaAdministrativa=n},alterarMesesGatilho:function(n){cotacao.QuantidadeMesesGatilho=n},adicionarVersao:function(n,t){var i=cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[0].quantidadeTotalVidas,r=cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[0].valorCapitalMedio;cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo.push(new VersaoCalculo(t,"Versão"+t,i,null,0,0,r,!1,[new TaxasResseguro(null,null,null)],!1));n&&n()},salvarNovaVersao:function(n){indiceVersaoSelecionada=cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo.findIndex(function(n){return n.numeroVersao==$("#selectVsCalculo").val()});n&&n()}};window.AnaliseDeRiscoEvents={initialize:function(){},OnClickInserirLinhaTaxaResseguro:function(){cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length==0&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.push(new TaxasResseguro(null,null,null));$("#idadeMinimaResseguro_"+indiceLinhasTaxaResseguro).val()==""||$("#idadeMaximaResseguro_"+indiceLinhasTaxaResseguro).val()==""||$("#taxaPorMil_"+indiceLinhasTaxaResseguro).val()==""?notification("erro","Para inclusão da faixa é necessário o preenchimento de todos os campos.",""):(window.AnaliseDeRiscoFunctions.InserirLinhaTaxaResseguro(),window.AnaliseDeRiscoUi.InserirLinhaTaxaResseguro(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length-1),window.AnaliseDeRiscoUi.addMasks())},OnClickRemoverLinhaTaxaResseguro:function(){if(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length>0)window.AnaliseDeRiscoUi.RemoverLinhaTaxaResseguro(indiceLinhasTaxaResseguro),window.AnaliseDeRiscoFunctions.RemoverLinhaTaxaResseguro(indiceLinhasTaxaResseguro)},onClickNovaVersao:function(){if(cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].indicadorVersaoCalculada){openModalWait();var n=cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo.length-1].numeroVersao+1;window.AnaliseDeRiscoUi.adicionarVersao(n);window.AnaliseDeRiscoFunctions.adicionarVersao(null,n);$("#selectVsCalculo").val(n).trigger("change");window.AnaliseDeRiscoFunctions.salvarNovaVersao(function(){window.AnaliseDeRiscoFunctions.salvarVersao()})}else notification("erro","A versão "+cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].numeroVersao+" do Cenário "+cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].numeroCenario+" não foi calculada. Calcule-a para criar uma nova versão.","")},onClickRemoverVersao:function(){confirm("Deseja realmente remover a versão?")&&(openModalWait(),window.AnaliseDeRiscoFunctions.removerVersao(function(){notification("sucesso","Versão excluída com sucesso.","");cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo.splice(indiceVersaoSelecionada,1);indiceVersaoSelecionada=0;window.AnaliseDeRiscoUi.removerTodasLinhaTaxaResseguro();window.AnaliseDeRiscoUi.carregarVersoesDoCenario();window.AnaliseDeRiscoUi.preencherCamposDaVersao();window.AnaliseDeRiscoUi.disableEnableCamposPorVersao();window.RelatoriosAnaliseDeRiscoUi.carregarVersoes()}))},onClickLimparVersao:function(){window.AnaliseDeRiscoUi.LimparVersao()},OnChangeCenario:function(n,t){openModalWait();indiceCenarioSelecionadoCalculo=t;window.AnaliseDeRiscoFunctions.salvarVersao(function(){indiceCenarioSelecionadoCalculo=n;indiceVersaoSelecionada=0;window.AnaliseDeRiscoUi.removerTodasLinhaTaxaResseguro();window.AnaliseDeRiscoUi.carregarVersoesDoCenario();window.AnaliseDeRiscoFunctions.obterCapitalMedio(function(){window.AnaliseDeRiscoUi.preencherCamposDaVersao()});window.AnaliseDeRiscoUi.disableEnableCamposPorVersao()})},OnChangeVersao:function(n){openModalWait();window.AnaliseDeRiscoFunctions.salvarVersao(function(){indiceVersaoSelecionada=cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo.findIndex(function(t){return t.numeroVersao==$(n).val()});window.AnaliseDeRiscoUi.removerTodasLinhaTaxaResseguro();window.AnaliseDeRiscoUi.preencherCamposDaVersao();window.AnaliseDeRiscoUi.disableEnableCamposPorVersao()})},onClickCalcularCenario:function(){if(window.AnaliseDeRiscoUi.validaPreenchimentoCamposVersao(),$(".input-validation-error").length>0)$("html, body").animate({scrollTop:$(".input-validation-error").offset().top-240},500);else{for(openModalWait(),i=0;i<cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length;i++)cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[i].idadeMaxima==null&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[i].idadeMinima==null&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[i].percentualTaxa==null&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.splice(i,1);window.AnaliseDeRiscoFunctions.calcularCenario()}},OnChangeCoeficienteAgravo:function(n){let t=convertePorcentagemParaDecimal($(n).val());cotacao.CoeficienteDescontoAgravoCnae=t},OnChangePorcentagemDACotacao:function(n){var t=$(n).maskMoney("unmasked")[0],i=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMaximoDespesasAdministrativas,r=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMinimoDespesasAdministrativas;t?t>i?($(n).addClass("input-validation-error"),notification("erro","Valor informado de DA Cotação, ultrapassa o limite máximo de "+helperFormatacao.formatarDecimal(i,2)+" do produto.","")):t<r?($(n).addClass("input-validation-error"),notification("erro","Valor informado de DA Cotação, ultrapassa o limite mínimo de "+helperFormatacao.formatarDecimal(r,2)+" do produto.","")):($(n).removeClass("input-validation-error"),window.AnaliseDeRiscoFunctions.alterarDACotacao(t)):($(n).addClass("input-validation-error"),notification("erro","O campo DA Cotação é de preenchimento obrigatório.",""))},OnChangePorcentagemDA:function(n){var t=$(n).maskMoney("unmasked")[0],i=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMaximoDespesaAdministrativaExcedenteTecnico,r=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMinimoDespesaAdministrativaExcedenteTecnico;t?t>i?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Excedente Técnico (DA), ultrapassa o limite máximo de "+helperFormatacao.formatarDecimal(i,2)+" do produto.","")):t<r?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Excedente Técnico (DA), ultrapassa o limite mínimo de "+helperFormatacao.formatarDecimal(r,2)+" do produto.","")):($(n).removeClass("input-validation-error"),cotacao.ExcedenteTecnico.PercentualDespesaAdministrativa=t):$(n).removeClass("input-validation-error")},OnChangePorcentagemIBNR:function(n){var t=$(n).maskMoney("unmasked")[0],i=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMaximoIBNRExcedenteTecnico,r=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMinimoIBNRExcedenteTecnico;t?t>i?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Excedente Técnico (IBNR), ultrapassa o limite máximo de "+helperFormatacao.formatarDecimal(i,2)+" do produto.","")):t<r?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Excedente Técnico (IBNR), ultrapassa o limite mínimo de "+helperFormatacao.formatarDecimal(r,2)+" do produto.","")):($(n).removeClass("input-validation-error"),cotacao.ExcedenteTecnico.PercentualIBNR=t):$(n).removeClass("input-validation-error")},OnChangePorcentagemDistribuicao:function(n){var t=$(n).maskMoney("unmasked")[0],i=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMaximoDistribuicaoEstipulanteExcedenteTecnico,r=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMinimoDistribuicaoEstipulanteExcedenteTecnico;t?t>i?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Excedente Técnico (Distribuição), ultrapassa o limite máximo de "+helperFormatacao.formatarDecimal(i,2)+" do produto.","")):t<r?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Excedente Técnico (Distribuição), ultrapassa o limite mínimo de "+helperFormatacao.formatarDecimal(r,2)+" do produto.","")):($(n).removeClass("input-validation-error"),cotacao.ExcedenteTecnico.PercentualDistribuicaoEstipulante=t):$(n).removeClass("input-validation-error")},OnChangeMeses:function(n){var t=parseInt($(n).val()),i=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.quantidadeMaximaMesGatilho,r=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.quantidadeMinimaMesGatilho;t?t>i?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Gatilho (Meses), ultrapassa o limite máximo de "+i+" do produto.","")):t<r?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Gatilho (Meses), ultrapassa o limite mínimo de "+r+" do produto.","")):($(n).removeClass("input-validation-error"),window.AnaliseDeRiscoFunctions.alterarMesesGatilho(t)):$(n).removeClass("input-validation-error")},OnChangeDescontoAgravoTecnico:function(n){$(n).val().length==0&&$(n).val("0,00");var t=parseInt($(n).val()),i=produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.percentualMaximoDescontoTecnico*-1;t?t<i?($(n).addClass("input-validation-error"),notification("erro","Valor informado do Desconto Técnico ultrapassa o limite máximo de "+helperFormatacao.formatarDecimal(i,2)+" do produto.","")):($(n).removeClass("input-validation-error"),cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].percentualDescontoAgravoTecnico=t):$(n).removeClass("input-validation-error")},OnChangeNomeVersao:function(n){$(n).val()?$(n).addClass("input-validation-error"):$(n).removeClass("input-validation-error");cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].nomeVersao=$(n).val()},OnChangeTabuaDeMortalidade:function(n){cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].codigoTipoTabelaTaxa=$(n).val();cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].descricaoTipoTabelaTaxa=$("#"+n.id+" option:selected").html()},OnChangeLimiteDeRetencao:function(n){cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].valorLimiteRetencaoResseguro=parseInt($(n).val())},OnChangeNomeVersao:function(n){$(n).val()?$(n).removeClass("input-validation-error"):$(n).addClass("input-validation-error");cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].nomeVersao=$(n).val()},onClickAbrirRelacaoDeVidasPopUp:function(){cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo]!=undefined&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada]!=undefined?$("#modalRelacaoVidas").modal("show"):alert("Calculo não disponível! Não foi possível abrir a relação de vidas.")},onChangeIdadeMinima:function(n,t){var i=parseInt($(n).val()),r=$("#idadeMaximaResseguro_"+t).val();if($(n).val()){if($(n).removeClass("input-validation-error"),i<produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMinimoContrato||i>produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMaximoContrato)$(n).addClass("input-validation-error"),notification("erro","O limite de idade permitido é mínimo "+produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMinimoContrato+" e máximo "+produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMaximoContrato+".","");else if(r!=""&&i>r)$(n).addClass("input-validation-error"),notification("erro","A Idade mínima não pode ser maior que a idade máxima.","");else for(let r=0;r<t;r++)if(r!=t&&i>=parseInt($("#idadeMinimaResseguro_"+r).val())&&i<=parseInt($("#idadeMaximaResseguro_"+r).val())){$(n).addClass("input-validation-error");invalido=1;notification("erro","Faixa de idade já cadastrada.","#"+$(this).attr("id"));break}}else $(n).addClass("input-validation-error");cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length==0&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.push(new TaxasResseguro(0,0,0));cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[t].idadeMinima=parseInt($(n).val())},onChangeIdadeMaxima:function(n,t){var i=parseInt($(n).val()),r=$("#idadeMinimaResseguro_"+t).val();if($(n).val()){if($(n).removeClass("input-validation-error"),i<produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMinimoContrato||i>produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMaximoContrato)$(n).addClass("input-validation-error"),notification("erro","O limite de idade permitido é mínimo "+produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMinimoContrato+" e máximo "+produtoComercialAnaliseRisco.produtoComercialVida.produtoComercialVida.idadeMaximoContrato+".","");else if(r!=""&&i<r)$(n).addClass("input-validation-error"),notification("erro","A Idade maxima não pode ser menor que a idade mínima.","");else for(let r=0;r<t;r++)if(r!=t&&i>=parseInt($("#idadeMinimaResseguro_"+r).val())&&i<=parseInt($("#idadeMaximaResseguro_"+r).val())){$(n).addClass("input-validation-error");invalido=1;notification("erro","Faixa de idade já cadastrada.","#"+$(this).attr("id"));break}}else $(n).addClass("input-validation-error");cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length==0&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.push(new TaxasResseguro(0,0,0));cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[t].idadeMaxima=parseInt($(n).val())},onChangeIdadeTaxaPorMil:function(n,t){$(n).val()?$(n).removeClass("input-validation-error"):$(n).addClass("input-validation-error");cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.length==0&&cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro.push(new TaxasResseguro(0,0,0));cotacao.CenariosCotacao[indiceCenarioSelecionadoCalculo].versoesCalculo[indiceVersaoSelecionada].taxasResseguro[t].percentualTaxa=$(n).maskMoney("unmasked")[0]},onClickExportarProjecaoFaturamento:function(){window.AnaliseDeRiscoUi.validaExportarRelatorio();$(".input-validation-error").length>0?$("html, body").animate({scrollTop:$(".input-validation-error").offset().top-240},500):window.AnaliseDeRiscoFunctions.exportarProjecaoFaturamento()}};indiceCenarioSelecionadoRelatorios=0;indiceVersaoSelecionadaRelatorios=0;let maiorIdadeRT=0,maiorCapitalRT=0;window.RelatoriosAnaliseDeRiscoUi={initialize:function(){indiceCenarioSelecionadoRelatorios=0;indiceVersaoSelecionadaRelatorios=0;window.RelatoriosAnaliseDeRiscoUi.carregarCenarios();window.RelatoriosAnaliseDeRiscoUi.carregarVersoes();window.RelatoriosAnaliseDeRiscoUi.carregarPlanos();cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].versoesCalculo[0].indicadorVersaoCalculada&&(window.RelatoriosAnaliseDeRiscoFunctions.obterResumoTecnico(),window.RelatoriosAnaliseDeRiscoFunctions.ObterProjecaoFaturamento(),window.RelatoriosAnaliseDeRiscoFunctions.obterFreecover())},rederizarResumoTecnico:function(n){var t={formatarDecimal:window.helperFormatacao.formatarDecimal},e=$("#templateCoberturas").render(n.coberturas.filter(function(n){return n.grupoExibicaoCobertura==="basica"}),t),i,r,u,f;$("#coberturasBasicas").html(e);i=$("#templateCoberturas").render(n.coberturas.filter(function(n){return n.grupoExibicaoCobertura==="adicional"}),t);$("#coberturasAdicionais").html(i);r=$("#templateCoberturas").render(n.coberturas.filter(function(n){return n.grupoExibicaoCobertura==="funeral"}),t);$("#coberturasFuneral").html(r);u=$("#templateCoberturas").render(n.coberturas.filter(function(n){return n.grupoExibicaoCobertura==="diaria"}),t);$("#coberturasDiarias").html(u);f=$("#templateServicos").render(n.coberturas.filter(function(n){return n.grupoExibicaoCobertura==="servico"}),t);$("#servicos").html(f);$("#taxaPuraTotal").text(helperFormatacao.formatarDecimal(n.coeficienteTaxaPonderadaLibertyFinal,4));$("#taxaResseguroTotal").text(helperFormatacao.formatarDecimal(n.coeficienteTaxaPonderadaResseguroFinal,4));$("#taxaComercialTotal").text(helperFormatacao.formatarDecimal(n.coeficienteTaxaPonderadaComercialFinalCoberturas,4));$("#custoTotalServicos").text(helperFormatacao.formatarDecimal(n.premio.valorPremioLiquidoComercialAssistencias,2,!0));$("#taxaComercialTotalServicos").text(helperFormatacao.formatarDecimal(n.coeficienteTaxaPonderadaComercialFinal,4));$("#PremioComercialLibertySemIOFRT").text(helperFormatacao.formatarDecimal(n.premio.valorPremioLiquidoComercialLiberty,2,!0));$("#PremioComercialResseguroSemIOFRT").text(helperFormatacao.formatarDecimal(n.premio.valorPremioLiquidoComercialResseguro,2,!0));$("#PremioComercialAssistenciasSemIOFRT").text(helperFormatacao.formatarDecimal(n.premio.valorPremioLiquidoComercialAssistencias,2,!0));$("#PremioComercialTotalSemIOFRT").text(helperFormatacao.formatarDecimal(n.premio.valorTotalPremioLiquidoComercial,2,!0));$("#PremioPuroAnualRT").text(helperFormatacao.formatarDecimal(n.premio.valorPremioLiquidoAnual,2,!0));$("#PremioMedioIndividualRT").text(helperFormatacao.formatarDecimal(n.premio.valorPremioLiquidoMedioIndividual,2,!0));$("#PremioTotalComIOFRT").text(helperFormatacao.formatarDecimal(n.premio.valorTotalPremioComercial,2,!0));$("#ComissaoRT").text(helperFormatacao.formatarDecimal(parseFloat(cotacao.TotaisComissionamento.TotalPercentualCorretagem),2));$("#ProLaboreRT").text(helperFormatacao.formatarDecimal(parseFloat(cotacao.TotaisComissionamento.TotalPercentualProLabore),2));$("#AgenciamentoRT").text(helperFormatacao.formatarDecimal(parseFloat(cotacao.TotaisComissionamento.TotalPercentualAgenciamento),2));$("#DART").text(helperFormatacao.formatarDecimal(cotacao.PercentualDespesaAdministrativa,2));$("#TabuaMortalidadeRT").text(n.tabuaMortalidadeEDescontos.descricaoTabuaMortalidade);$("#descontoAgravoTecnicoRT").text(helperFormatacao.formatarDecimal(n.tabuaMortalidadeEDescontos.percentualDescontoAgravoTecnico,2)+"%");n.tabuaMortalidadeEDescontos.indicadorDescontoAgravoResseguro?$("#descontoAgravoResseguroRT").text("Sim"):$("#descontoAgravoResseguroRT").text("Não");$("#quantidadeVidasGrupoRT").text(n.grupoAnalisado.quantidadeTotalVidas);$("#quantidadeVidasResseguradasRT").text(n.grupoAnalisado.quantidadeVidasResseguradas);$("#idadeMediaRT").text(n.grupoAnalisado.idadeMedia);$("#idadeMediaAtuarialRT").text(n.grupoAnalisado.idadeMediaAtuarial);$("#idadeMaximaRT").text(n.grupoAnalisado.idadeMaxima);$("#porcentagemGeneroFemininoRT").text(n.grupoAnalisado.percentualVidasGeneroFeminino);$("#porcentagemGeneroMasculinoRT").text(n.grupoAnalisado.percentualVidasGeneroMasculino);$("#quantidadeAfastadosRT").text(n.grupoAnalisado.quantidadeTotalVidasAfastadas);$("#quantidadeVidasAcimaRT").text(n.grupoAnalisado.quantidadeVidasForaDoLimiteDeIdade);$("#modalidadeRT").text(n.capitais.tipoModalidadeCapital);$("#limiteRetencaoLibertyRT").text(helperFormatacao.formatarDecimal(n.capitais.valorLimiteRetencaoLiberty,2,!0));$("#totalCapitalRetidoLibertyRT").text(helperFormatacao.formatarDecimal(n.capitais.valorTotalCapitalRetidoLiberty,2,!0));$("#totalCapitalRetidoResseguroRT").text(helperFormatacao.formatarDecimal(n.capitais.valorTotalCapitalRetidoResseguro,2,!0));$("#totalCapitalLibertyResseguroRT").text(helperFormatacao.formatarDecimal(n.capitais.valorTotalCapitalRetido,2,!0));$("#capitalMinimoRT").text(helperFormatacao.formatarDecimal(n.capitais.valorCapitalMinimo,2,!0));$("#capitalMaximoRT").text(helperFormatacao.formatarDecimal(n.capitais.valorCapitalMaximo,2,!0));$("#capitalMedioRT").text(helperFormatacao.formatarDecimal(n.capitais.valorCapitalMedio,2,!0));$("#capitalSeguradoMaisVelhoRT").text(helperFormatacao.formatarDecimal(n.capitais.valorCapitalMaiorIdade,2,!0));$("#capitalMedioConcentracaoRT").text(n.capitais.valorCapitalMedioConcentracaoGrupo+"%");$("#TotalCapitalResseguradoVidasAcima70RT").text(helperFormatacao.formatarDecimal(n.capitais.valorTotalCapitalResseguradoForaLimiteIdade,2,!0));$("#paridadeRT").text(n.capitais.numeroParidade);$("#expectativaRT").text(helperFormatacao.formatarDecimal(n.expectativaSinistro.percentualExpectativa,2));$("#sinistroPorMilRT").text(helperFormatacao.formatarDecimal(n.expectativaSinistro.percentualSinistroPorMil,2));$("#anosDeRecuperacaoRT").text(parseInt(n.expectativaSinistro.quantidadeAnosRecuperacao))},renderizarFreecover:function(n){$("#ISAcimaLimiteIdadeFreecover").text(helperFormatacao.formatarDecimal(n.aceitacaoGrupo.valorCapitalAcimaIdadeFreeCover,2,!0));$("#LimiteMaximoAbrangenciaFreecover").text(helperFormatacao.formatarDecimal(n.aceitacaoGrupo.valorLimiteMaximoAbrangenciaFreeCover,2,!0));$("#SomaMediaSeguradaFreecover").text(helperFormatacao.formatarDecimal(n.aceitacaoGrupo.valorSomaMediaSegurada,2,!0));$("#LimiteFreecover").text(helperFormatacao.formatarDecimal(n.aceitacaoGrupo.valorLimiteFreeCover,2,!0));$("#PorcentagemGrupoFreecover").text(n.aceitacaoGrupo.percentualGrupo);n.indicadorLimiteGrupoUltrapassado?($("#FreecoverFcl").addClass("glyphicon glyphicon-remove"),$("#FreecoverFcl").css("color","red")):($("#FreecoverFcl").addClass("glyphicon glyphicon-ok"),$("#FreecoverFcl").css("color","green"))},carregarCenarios:function(){$("#cenariosRel > li").remove();cotacao.CenariosCotacao.forEach(function(n){n.versoesCalculo.some(function(n){return n.indicadorVersaoCalculada==!0})&&(n.numeroCenario===1?$("#cenariosRel").append("<li class='active'><a data-toggle='tab' href='#' id='liCen"+n.numeroCenario+"AR'>Cen. "+n.numeroCenario+"<\/a><\/li >"):$("#cenariosRel").append("<li><a data-toggle='tab' href='#' id='liCen"+n.numeroCenario+"AR'>Cen. "+n.numeroCenario+"<\/a><\/li >"))});$("#cenariosRel a").unbind("shown.bs.tab");$("#cenariosRel a").on("shown.bs.tab",function(n){window.RelatoriosAnaliseDeRiscoEvents.onChangeCenario($(n.target).closest("li").index(),$(n.relatedTarget).closest("li").index())})},carregarVersoes:function(){$("#selectVsCalculoRel").empty();$("#selectVsCalculoRel").append('<option value="-1">Selecione<\/option>');cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].versoesCalculo.forEach(function(n){n.indicadorVersaoCalculada&&$("#selectVsCalculoRel").append('<option value="'+n.numeroVersao+'">'+n.numeroVersao+"<\/option>")})},adicionarVersaoNoDropdown:function(n){var t=!0;$("#selectVsCalculoRel option").each(function(){$(this).val()==n&&(t=!1)});t&&($("#selectVsCalculoRel").append('<option value="'+n+'">'+n+"<\/option>"),$("#selectVsCalculoRel").change())},carregarPlanos:function(){$("#selecPlanoRel").empty();$("#selecPlanoRel").append('<option value="-1">Selecione<\/option>');cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].indicadorPlanoMesmaCobertura&&cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].planosCondicoesComerciais.length>1&&$("#selecPlanoRel").append('<option value="0">TODOS OS PLANOS<\/option>');cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].planosCondicoesComerciais.forEach(function(n){$("#selecPlanoRel").append('<option value="'+n.numeroPlano+'">'+n.nomePlano+"<\/option>")})}};window.RelatoriosAnaliseDeRiscoFunctions={obterResumoTecnico:function(){$.ajax({url:"/calculo/ObterResumoTecnico",type:"post",contentType:"application/json",success:function(n){window.RelatoriosAnaliseDeRiscoUi.rederizarResumoTecnico(n.value);maiorIdadeRT=n.value.grupoAnalisado.idadeMaxima;maiorCapitalRT=n.value.capitais.valorCapitalMaximo;closeModalWait()},error:function(n){var i,t;for(closeModalWait(),i=JSON.parse(n.responseText),t=0;t<i.length;t++)notification("erro",i[t],"")},data:JSON.stringify({NumeroCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario,NumeroVersao:parseInt($("#selectVsCalculoRel").val()),NumeroPlano:parseInt($("#selecPlanoRel").val())})})},obterFreecover:function(){$.ajax({url:"/calculo/ObterFreecover",type:"post",contentType:"application/json",success:function(n){window.RelatoriosAnaliseDeRiscoUi.renderizarFreecover(n.value);closeModalWait()},error:function(n){var i,t;for(closeModalWait(),i=JSON.parse(n.responseText),t=0;t<i.length;t++)notification("erro",i[t],"")},data:JSON.stringify({NumeroCotacao:cotacao._id,NumeroCenario:cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario,NumeroVersao:parseInt($("#selectVsCalculoRel").val()),NumeroPlano:parseInt($("#selecPlanoRel").val())})})},ValidarDistribuicaoCapitalIntervaloCapitais:function(){if($("#txtDCIntervaloCapitais").val()!==""&&parseFloat($("#txtDCCapitalMaximo").maskMoney("unmasked")[0])>0){var n=parseFloat($("#txtDCIntervaloCapitais").maskMoney("unmasked")[0]);if(n<.01||n>maiorCapitalRT)return notification("erro","O Intervalo de Capitais deve ser maior que 0 e menor ou igual que o valor do Maior Capital informado de "+maiorCapitalRT.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),"txtDCIntervaloCapitais"),!1}return $("#txtDCIntervaloCapitais").removeClass("input-validation-error"),!0},ValidarDistribuicaoCapitalIntervaloIdade:function(){if($("#txtDCIntervaloIdade").val()!==""&&$("#txtDCIdadeMaxima").val()!==""){var n=parseInt($("#txtDCIntervaloIdade").val());if(n<1||n>maiorIdadeRT)return notification("erro","O Intervalo de Faixa de Idade deve ser maior que 0 e menor que a Idade Máxima informada de "+maiorIdadeRT,"txtDCIntervaloIdade"),!1}return $("#txtDCIntervaloIdade").removeClass("input-validation-error"),!0},ValidarDistribuicaoCapitalMenorCapital:function(){var n=$("#txtDCCapitalMinimo").val()===""?0:parseFloat($("#txtDCCapitalMinimo").maskMoney("unmasked")[0]),t=parseFloat($("#txtDCCapitalMaximo").maskMoney("unmasked")[0]);return n<0||n>t?(notification("erro","O valor do Menor Capital deve ser menor ou igual que o valor do Maior Capital informado.","txtDCCapitalMinimo"),!1):($("#txtDCCapitalMinimo").removeClass("input-validation-error"),!0)},ValidarDistribuicaoCapitalIdadeMinima:function(){var n=$("#txtDCIdadeMinima").val()===""?0:parseInt($("#txtDCIdadeMinima").val()),t=parseInt($("#txtDCIdadeMaxima").val());return n<0||n>t?(notification("erro","O campo Idade Mínima deve ser menor ou igual ao valor do campo Idade máxima.","txtDCIdadeMinima"),!1):($("#txtDCIdadeMinima").removeClass("input-validation-error"),!0)},ValidarDistribuicaoCapitalMaiorCapital:function(){if($("#txtDCCapitalMaximo").val()===""&&$("#txtDCIntervaloCapitais").val()!=="")return notification("erro","O valor do Maior Capital deve ser informado.","txtDCCapitalMaximo"),!1;if($("#txtDCCapitalMaximo").val()!==""){var n=parseFloat($("#txtDCCapitalMaximo").maskMoney("unmasked")[0]),t=parseFloat($("#txtDCCapitalMinimo").maskMoney("unmasked")[0]);if(n<t)return notification("erro","O valor do Maior Capital deve ser maior ou igual que o valor do Menor Capital informado.","txtDCCapitalMaximo"),!1}return $("#txtDCCapitalMaximo").removeClass("input-validation-error"),!0},ValidarDistribuicaoCapitalIdadeMaxima:function(){if($("#txtDCIdadeMaxima").val()===""&&parseInt($("#txtDCIntervaloIdade").val())>0)return notification("erro","A Idade Máxima deve ser informada.","txtDCIdadeMaxima"),!1;if($("#txtDCIdadeMaxima").val()!==""){var n=parseInt($("#txtDCIdadeMaxima").val()),t=parseInt($("#txtDCIdadeMinima").val());if(n<t)return notification("erro","A Idade Máxima deve ser maior ou igual ao valor Idade Mínima informada.","txtDCIdadeMaxima"),!1}return $("#txtDCIdadeMaxima").removeClass("input-validation-error"),!0},CalcularDistribuicaocapital:function(n,t,i,r,u,f,e,o,s,h,c,l){$.ajax({url:"/calculo/DistribuicaoCapital/",type:"post",contentType:"application/json",success:function(n){closeModalWait();n.value.mensagem!==null&&n.value.mensagem!==""?notification("erro",n.value.mensagem,""):notification("sucesso","Relatório atualizado com sucesso!","")},error:function(n){var i,t;for(closeModalWait(),n.value.mensagem!==null&&n.value.mensagem!==""&&notification("erro",n.value.mensagem,""),i=JSON.parse(n.messages),t=0;t<i.length;t++)notification("erro",i[t],"")},data:JSON.stringify({CodigoProdutoComercial:n,DataReferencia:t,NumeroCotacao:i,NumeroCenario:r,NumeroVersao:u,NumeroPlano:f,IntervaloCapital:e,MenorCapital:o,MaiorCapital:s,IntervaloFaixaIdade:h,IdadeMinima:c,IdadeMaxima:l})})},ObterProjecaoFaturamento:function(){$.ajax({url:"/calculo/ObterProjecaoFaturamento/",type:"post",contentType:"application/json",success:function(n){window.RelatoriosAnaliseDeRiscoFunctions.CarregarProjecaoFaturamento(n)},error:function(n){var i,t;if(n.messages!=undefined)for(i=JSON.parse(n.messages),t=0;t<i.length;t++)notification("erro",i[t],"")},data:JSON.stringify({NumeroCotacao:parseInt(cotacao._id),NumeroCenario:parseInt(cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario),NumeroVersao:parseInt(cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].versoesCalculo[indiceVersaoSelecionadaRelatorios].numeroVersao),NumeroPlano:parseInt($("#selecPlanoRel").val())})})},CarregarProjecaoFaturamento:function(n){n.value!=undefined&&($("#spValorPremioPF").html(n.value.valorTotal.valorPremioEmitido.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorAsssitenciasPF").html(n.value.valorTotal.valorPremioAssitencias.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorResseguroPF").html(n.value.valorTotal.valorPremioResseguro.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorCosseguroPF").html(n.value.valorTotal.valorPremioCosseguro.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorPremioGanhoPF").html(n.value.valorTotal.valorPremioGanho.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorComissaoPF").html(n.value.valorTotal.valorComissao.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorProLaborePF").html(n.value.valorTotal.valorProLabore.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorAgenciamentoPF").html(n.value.valorTotal.valorAgenciamento.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorDespAdmPF").html(n.value.valorTotal.valorDespesasAdministrativas.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorSinProjPF").html(n.value.valorTotal.valorSinistrosProjetados.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spValorResultadoPF").html(n.value.valorTotal.valorResultado.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})),$("#spPercPremioPF").html(n.value.percentualTotal.percentualPremioEmitido.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercAsssitenciasPF").html(n.value.percentualTotal.percentualPremioAssitencias.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercResseguroPF").html(n.value.percentualTotal.percentualPremioResseguro.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercCosseguroPF").html(n.value.percentualTotal.percentualPremioCosseguro.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercPremioGanhoPF").html(n.value.percentualTotal.percentualPremioGanho.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercComissaoPF").html(n.value.percentualTotal.percentualComissao.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercProLaborePF").html(n.value.percentualTotal.percentualProLabore.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercAgenciamentoPF").html(n.value.percentualTotal.percentualAgenciamento.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercDespAdmPF").html(n.value.percentualTotal.percentualDespesasAdministrativas.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercSinProjPF").html(n.value.percentualTotal.percentualSinistrosProjetados.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"),$("#spPercResultadoPF").html(n.value.percentualTotal.percentualResultado.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})+"%"))},ExportarFreecover:function(){var n=cotacao._id,t=parseInt($("#selecPlanoRel").val()),i=cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario,r=parseInt($("#selectVsCalculoRel").val());$.ajax({url:"/relatorio/Freecover",type:"post",contentType:"application/json",success:function(n){closeModalWait();n.fileContents!=null?(blob=converBase64toBlob(n.fileContents,n.contentType),saveFile(blob,n.fileDownloadName)):notification("erro","Relatório não disponível para exportação!")},error:function(){closeModalWait();notification("erro","Erro ao tentar exportar o arquivo!")},data:JSON.stringify({IdCotacao:n,NumeroPlano:t,NumeroCenario:i,NumeroVersao:r,TipoRelatorio:"Freecover"})})},ExportarResumoTecnico:function(){var n=cotacao._id,t=parseInt($("#selecPlanoRel").val()),i=cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario,r=parseInt($("#selectVsCalculoRel").val());$.ajax({url:"/relatorio/ResumoTecnico",type:"post",contentType:"application/json",success:function(n){closeModalWait();n.fileContents!=null?(blob=converBase64toBlob(n.fileContents,n.contentType),saveFile(blob,n.fileDownloadName)):notification("erro","Relatório não disponível para exportação!")},error:function(){closeModalWait();notification("erro","Erro ao tentar exportar o arquivo!")},data:JSON.stringify({IdCotacao:n,NumeroPlano:t,NumeroCenario:i,NumeroVersao:r,TipoRelatorio:"ResumoTecnico"})})},ExportarDistribuicaoCapital:function(){var n=cotacao._id,t=parseInt($("#selecPlanoRel").val()),i=cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario,r=parseInt($("#selectVsCalculoRel").val());$.ajax({url:"/relatorio/DistribuicaoCapital",type:"post",contentType:"application/json",success:function(n){closeModalWait();n.fileContents!=null?(blob=converBase64toBlob(n.fileContents,n.contentType),saveFile(blob,n.fileDownloadName)):notification("erro","Relatório não disponível para exportação!")},error:function(){closeModalWait();notification("erro","Erro ao tentar exportar o arquivo!")},data:JSON.stringify({IdCotacao:n,NumeroPlano:t,NumeroCenario:i,NumeroVersao:r,TipoRelatorio:"DistribuicaoCapital"})})}};window.RelatoriosAnaliseDeRiscoEvents={onChangeCenario:function(n){openModalWait();indiceCenarioSelecionadoRelatorios=n;indiceVersaoSelecionadaRelatorios=0;window.RelatoriosAnaliseDeRiscoUi.carregarVersoes();window.RelatoriosAnaliseDeRiscoUi.carregarPlanos();cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].versoesCalculo[0].indicadorVersaoCalculada&&(window.RelatoriosAnaliseDeRiscoFunctions.obterResumoTecnico(),window.RelatoriosAnaliseDeRiscoFunctions.ObterProjecaoFaturamento(),window.RelatoriosAnaliseDeRiscoFunctions.obterFreecover())},onChangeVersao:function(n){openModalWait();indiceVersaoSelecionadaRelatorios=cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].versoesCalculo.findIndex(function(t){return t.numeroVersao==$(n).val()});window.RelatoriosAnaliseDeRiscoUi.carregarPlanos();window.RelatoriosAnaliseDeRiscoFunctions.obterResumoTecnico();window.RelatoriosAnaliseDeRiscoFunctions.ObterProjecaoFaturamento();window.RelatoriosAnaliseDeRiscoFunctions.obterFreecover();closeModalWait()},onChangePlano:function(){openModalWait();window.RelatoriosAnaliseDeRiscoFunctions.obterResumoTecnico();window.RelatoriosAnaliseDeRiscoFunctions.ObterProjecaoFaturamento();window.RelatoriosAnaliseDeRiscoFunctions.obterFreecover();closeModalWait()},OnClickAtualizarRelatorioDistribuicaoCapital:function(){var n,t;if(openModalWait(),$("#txtDCIntervaloCapitais").removeClass("input-validation-error"),$("#txtDCIntervaloIdade").removeClass("input-validation-error"),$("#txtDCCapitalMinimo").removeClass("input-validation-error"),$("#txtDCIdadeMinima").removeClass("input-validation-error"),$("#txtDCCapitalMaximo").removeClass("input-validation-error"),$("#txtDCIdadeMaxima").removeClass("input-validation-error"),$("#txtDCIntervaloCapitais").val()===""&&$("#txtDCCapitalMinimo").val()===""&&$("#txtDCCapitalMaximo").val()===""&&$("#txtDCIntervaloIdade").val()===""&&$("#txtDCIdadeMinima").val()===""&&$("#txtDCIdadeMaxima").val()==="")notification("erro","Para atualizar o relatório, deve-se preencher os campos de limitadores.",""),closeModalWait();else{var i=window.RelatoriosAnaliseDeRiscoFunctions.ValidarDistribuicaoCapitalMenorCapital(),r=window.RelatoriosAnaliseDeRiscoFunctions.ValidarDistribuicaoCapitalMaiorCapital(),u=window.RelatoriosAnaliseDeRiscoFunctions.ValidarDistribuicaoCapitalIdadeMinima(),f=window.RelatoriosAnaliseDeRiscoFunctions.ValidarDistribuicaoCapitalIdadeMaxima();i&&r&&(n=window.RelatoriosAnaliseDeRiscoFunctions.ValidarDistribuicaoCapitalIntervaloCapitais());u&&f&&(t=window.RelatoriosAnaliseDeRiscoFunctions.ValidarDistribuicaoCapitalIntervaloIdade());n&&t?window.RelatoriosAnaliseDeRiscoFunctions.CalcularDistribuicaocapital(parseInt(cotacao.ProdutoComercial.Codigo),cotacao.DataReferencia,parseInt(cotacao._id),parseInt(cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].numeroCenario),parseInt(cotacao.CenariosCotacao[indiceCenarioSelecionadoRelatorios].versoesCalculo[indiceVersaoSelecionadaRelatorios].numeroVersao),parseInt($("#selecPlanoRel").val()),$("#txtDCIntervaloCapitais").val()===""?null:parseInt($("#txtDCIntervaloCapitais").maskMoney("unmasked")[0]),$("#txtDCCapitalMinimo").val()===""?0:parseFloat($("#txtDCCapitalMinimo").maskMoney("unmasked")[0]),$("#txtDCCapitalMaximo").val()===""?null:parseFloat($("#txtDCCapitalMaximo").maskMoney("unmasked")[0]),$("#txtDCIntervaloIdade").val()===""?null:parseInt($("#txtDCIntervaloIdade").val()),$("#txtDCIdadeMinima").val()===""?0:parseInt($("#txtDCIdadeMinima").val()),$("#txtDCIdadeMaxima").val()===""?null:parseInt($("#txtDCIdadeMaxima").val())):closeModalWait()}},OnClickExportarResumoTecnico:function(){openModalWait();window.RelatoriosAnaliseDeRiscoFunctions.ExportarResumoTecnico()},OnClickExportarFreecover:function(){openModalWait();window.RelatoriosAnaliseDeRiscoFunctions.ExportarFreecover()},OnClickExportarDistribuicaoCapital:function(){openModalWait();window.RelatoriosAnaliseDeRiscoFunctions.ExportarDistribuicaoCapital()}};